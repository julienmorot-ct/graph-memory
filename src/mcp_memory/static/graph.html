<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Temple â€” Graph Memory</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="/static/css/graph.css">
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ã‰CRAN DE LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="login-overlay" id="loginOverlay">
    <div class="login-card">
        <img src="/static/img/logo-cloudtemple.svg" alt="Cloud Temple" class="login-logo">
        <h2>Graph Memory</h2>
        <p class="login-subtitle">Visualisation du graphe de connaissances</p>
        <div class="login-form">
            <label for="loginToken">ğŸ”‘ Token d'accÃ¨s</label>
            <input type="password" id="loginToken" placeholder="Collez votre token iciâ€¦" autocomplete="off" spellcheck="false">
            <div class="login-error" id="loginError"></div>
            <button id="loginBtn">Se connecter</button>
        </div>
        <p class="login-hint">Contactez votre administrateur pour obtenir un token d'accÃ¨s.</p>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="header">
    <div class="header-brand">
        <img src="/static/img/logo-cloudtemple.svg" alt="Cloud Temple" class="header-logo">
        <span class="header-separator">|</span>
        <h1>Graph Memory</h1>
    </div>
    <div class="controls">
        <select id="memorySelect"><option value="">-- MÃ©moire --</option></select>
        <button id="loadBtn" disabled>Charger</button>
        <button class="btn-settings" id="settingsBtn">âš™ï¸</button>
        <button class="btn-settings" id="fitBtn" style="background:#2ecc71!important">ğŸ” Fit</button>
        <button class="btn-settings" id="askBtn" disabled style="background:#e67e22!important">ğŸ’¬ Ask</button>
        <span class="header-separator">|</span>
        <select id="layoutSelect" class="layout-select" title="Forme du graphe">
            <option value="barnesHut">ğŸŒ¿ Organique</option>
            <option value="forceAtlas2">ğŸ”¬ ForceAtlas2</option>
            <option value="hierarchicalUD">ğŸ“ HiÃ©rarchie â†“</option>
            <option value="hierarchicalLR">ğŸ“ HiÃ©rarchie â†’</option>
        </select>
        <button class="btn-toggle active" id="toggleEdgeLabels" title="Labels des arÃªtes">ğŸ·ï¸</button>
        <button class="btn-toggle active" id="toggleShadows" title="Ombres des nÅ“uds">ğŸ’¡</button>
        <button class="btn-toggle active" id="toggleSmooth" title="ArÃªtes courbes">ã€°ï¸</button>
        <button class="btn-toggle active" id="toggleMentions" title="Liens Document â†” EntitÃ© (MENTIONS)">ğŸ“„</button>
        <button class="btn-logout" id="logoutBtn" title="DÃ©connexion">ğŸ”“</button>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BANNIÃˆRE MODE ISOLATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="isolation-banner" id="isolationBanner">
    <span>ğŸ”¬ <strong>Mode Focus</strong> â€” Affichage du sous-graphe liÃ© Ã  votre question</span>
    <button id="exitIsolationBtn">ğŸ”„ Graphe complet</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALE PARAMÃˆTRES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal">
        <h2>âš™ï¸ ParamÃ¨tres du graphe</h2>
        <div class="param-group"><label>Distance (springLength)</label><div class="param-row"><input type="range" id="paramSpringLength" min="100" max="800" value="400"><span class="param-value" id="valSpringLength">400</span></div></div>
        <div class="param-group"><label>RÃ©pulsion (gravity)</label><div class="param-row"><input type="range" id="paramGravity" min="1000" max="50000" value="15000"><span class="param-value" id="valGravity">-15000</span></div></div>
        <div class="param-group"><label>Taille nÅ“uds</label><div class="param-row"><input type="range" id="paramNodeSize" min="10" max="50" value="20"><span class="param-value" id="valNodeSize">20</span></div></div>
        <div class="param-group"><label>Taille texte</label><div class="param-row"><input type="range" id="paramFontSize" min="8" max="20" value="11"><span class="param-value" id="valFontSize">11</span></div></div>
        <div class="modal-actions"><button class="btn-secondary" id="resetParams">Reset</button><button id="applyParams">Appliquer</button></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LAYOUT PRINCIPAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="main">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="sidebar">

        <!-- Stats -->
        <h3>ğŸ“Š Stats</h3>
        <div class="stats">
            <div class="stat"><span>EntitÃ©s</span><span class="stat-value" id="nodeCount">-</span></div>
            <div class="stat"><span>Relations</span><span class="stat-value" id="edgeCount">-</span></div>
        </div>

        <!-- â•â•â• FILTRE : Types d'entitÃ©s â•â•â• -->
        <div class="filter-section">
            <div class="filter-header" onclick="toggleFilterSection('entityTypes')">
                <span>ğŸ·ï¸ Types d'entitÃ©s</span>
                <span class="filter-chevron" id="chevron-entityTypes">â–¼</span>
            </div>
            <div class="filter-actions" id="actions-entityTypes">
                <button onclick="selectAllEntityTypes()" title="Tout afficher">Tous</button>
                <button onclick="selectNoEntityTypes()" title="Tout masquer">Aucun</button>
                <button onclick="invertEntityTypes()" title="Inverser">Inverser</button>
            </div>
            <div class="filter-body" id="body-entityTypes">
                <!-- Checkboxes gÃ©nÃ©rÃ©es dynamiquement par sidebar.js -->
                <div class="filter-empty">Chargez une mÃ©moireâ€¦</div>
            </div>
        </div>

        <!-- â•â•â• FILTRE : Types de relations â•â•â• -->
        <div class="filter-section">
            <div class="filter-header" onclick="toggleFilterSection('edgeTypes')">
                <span>ğŸ”— Types de relations</span>
                <span class="filter-chevron" id="chevron-edgeTypes">â–¼</span>
            </div>
            <div class="filter-actions" id="actions-edgeTypes">
                <button onclick="selectAllEdgeTypes()">Tous</button>
                <button onclick="selectNoEdgeTypes()">Aucun</button>
                <button onclick="invertEdgeTypes()">Inverser</button>
            </div>
            <div class="filter-body" id="body-edgeTypes">
                <div class="filter-empty">Chargez une mÃ©moireâ€¦</div>
            </div>
        </div>

        <!-- â•â•â• FILTRE : Documents â•â•â• -->
        <div class="filter-section">
            <div class="filter-header" onclick="toggleFilterSection('documents')">
                <span>ğŸ“„ Documents</span>
                <span class="filter-chevron" id="chevron-documents">â–¼</span>
            </div>
            <div class="filter-actions" id="actions-documents">
                <button onclick="selectAllDocuments()">Tous</button>
                <button onclick="selectNoDocuments()">Aucun</button>
            </div>
            <div class="filter-body" id="body-documents">
                <div class="filter-empty">Chargez une mÃ©moireâ€¦</div>
            </div>
        </div>

        <!-- Recherche -->
        <h3>ğŸ” Recherche</h3>
        <input type="text" id="searchInput" placeholder="Rechercher une entitÃ©â€¦">

        <!-- Liste d'entitÃ©s -->
        <h3>ğŸ“‹ EntitÃ©s <span id="entityListCount" style="color:#888;font-size:0.75rem"></span></h3>
        <div class="entity-list" id="entityList"></div>

    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ZONE GRAPHE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="graph-container">
        <div id="graph"></div>
        <div class="loading" id="loading" style="display:none"><div class="spinner"></div><p>Chargementâ€¦</p></div>
        <div class="node-details" id="nodeDetails">
            <button class="node-details-close" onclick="hideNodeDetails()">âœ•</button>
            <div id="detailContent"></div>
        </div>

        <!-- Panneau ASK (en bas du graphe) -->
        <div class="ask-panel" id="askPanel">
            <div class="ask-header">
                <span>ğŸ’¬</span>
                <input type="text" id="askInput" placeholder="Posez une question sur cette mÃ©moireâ€¦">
                <button id="askSubmitBtn">Envoyer</button>
                <button class="ask-close" id="askCloseBtn">âœ•</button>
            </div>
            <div class="ask-body" id="askBody">
                <p style="color:#888;font-size:0.85rem">Posez une question en langage naturel. Les entitÃ©s trouvÃ©es seront mises en Ã©vidence dans le graphe.</p>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS MODULAIRES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="/static/js/config.js"></script>
<script src="/static/js/api.js"></script>
<script src="/static/js/graph.js"></script>
<script src="/static/js/sidebar.js"></script>
<script src="/static/js/ask.js"></script>
<script src="/static/js/app.js"></script>

</body>
</html>
